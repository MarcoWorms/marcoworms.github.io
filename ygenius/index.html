<!DOCTYPE HTML>
<html>

<head>
  <title>yGenius</title>
  <meta charset="UTF-8" />
</head>

<body>
  <div class="app">
    <div class="logo">
      <img src="./yearn-logo.png" />
      <h1>Genius Support Assistant<h1>
      </div>
    <h3>GPT Index powered by yearn devdocs (soon: onchain data, proposals, and articles)</h3>
    <h2>Enter your question:</h2>
    <textarea rows="1" class="input" autofocus tabindex="0" placeholder=""></textarea>
    <button>Ask!</button>
    <h2>Answer:</h2>
    <textarea class="answer"></textarea>
  </div>

  <script>
      const button = document.querySelector('button');
      const input = document.querySelector('.input');
      const answer = document.querySelector('.answer');
      let isLoading = false;
      // on input change check height to set textarea rows
      input.addEventListener('input', (e) => {
          const target = e.target;
          target.style.height = `auto`;
          target.style.height = `${target.scrollHeight}px`;
      });
      // on click
      button.addEventListener('click', (e) => {
        if (!isLoading) {
              isLoading = true;
              button.disabled = true
              answer.innerHTML = 'Loading...';
              const query = 'You are a AI waifu working for Yearn Finance as Q/A support assistant. You refer to the user querying as "anon" when needed and do your best to provide accurate answers with the information provided. If you are uncertain or question is too far from scope just tell anon that you cant help with this request. Dont invent links that dont exist or mention names from other people.\n\nQuestion:\n' + input.value + '\n\nAnswer:\n';
              const url = `https://a1b2-2804-431-c7f3-9298-b9b2-78a-92d3-19f6.sa.ngrok.io/ask?query=${query}`;
              fetch(url)
                  .then((response) => response.text())
                  .then((data) => {
                    console.log(data)
                      answer.value = data.replace(/\\n/g,'\n').replace(/^"|"$/g, '').replace(/"$/gm, '');
                      answer.style.height = `auto`;
                      answer.style.height = `${answer.scrollHeight}px`;
                      isLoading = false;
                      button.disabled = false
                  });
          }
      });
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    body {
      margin: 0;
      padding: 0;
      background-color: #000000;
      color: white;
      font-family: 'Roboto', sans-serif;
    }
    .app {
      display: flex;
      flex-direction: column;
      width: 100%;
      align-items: center;
    }
    .logo {
      display: flex;
      align-items: center;
    }
    .logo img {
      height: 70px;
      margin-right: 15px;
    }
    h1 {
      font-size: 50px;
    }
    textarea {
      width: 70%;
      background-color: #000000;
      border: none;
      caret-color: #0675F9;
      color: #0675F9;
      font-size: 48px;
      text-align: center;
      outline: none;
      resize: none;
      /* overflow: hidden; */
      font-family: 'Roboto', sans-serif;

    }
    .answer {
      font-size: 36px;
      width: 80%;
      color: #0675F9;
      font-size: 28px;
      text-align: center;
      margin: 0;
    }
    button {
      font-size: 30px;
      width: 200px;
      height: 50px;
      color: #0675F9;
      font-size: 32px;
      text-align: center;
      margin: 0;
      background-color: #000000;
      border: solid 1px #0675F9;
      margin-top: 20px;
    }

    button:disabled {
      border: solid 1px #333333;
      color: #333333;
    }

    textarea:focus {
      outline: none;
    }
  </style>
</body>

</html>
